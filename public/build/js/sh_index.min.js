function SmartHoneIndex(){"use strict";Controller.call(this),Port.call(this),this.userid=getUserId(),this.init()}SmartHoneIndex.prototype={init:function(){this.autoMainContent(),this.getUserState(30),this.menuTabs(),this.getMenus(0,1),this.getMsgList("todo",30),this.getMsgList("notice",30)},autoMainContent:function(){function t(){var t=$(".navbar").outerHeight(),n=$("#breadcrumbs").outerHeight(),i=$(window).height();$(".main-content").height(i-t-n-5)}var n=this;t(),$(window).resize(n.throttle(function(){t()},70,150))},getUserState:function(t){function n(t){setTimeout(function(){$.get(i.getUrl("ping"),{userid:i.userid},function(){n(t)})},1e3*t)}var i=this;n(t)},menuTabs:function(){function t(t,n,i,s){var e=$("#breadcrumbs ul"),a=$("li",e);if(!e.length)return!1;var r='<i class="'+i+' home-icon"></i><a href="'+(n||"#")+'" target="iframeStyle">'+t+'</a><span class="divider"><i class="icon-angle-right arrow-icon"></i></span>';a.eq(s).length||(e.append("<li></li>"),a=$("li",e)),a.eq(s).addClass("active").html(r).siblings("li").removeClass("active").end().nextAll("li").remove()}var n=this,i=$("#sidebar-shortcuts .btn:first");t(i.attr("title"),null,i.children("i").attr("class"),0),$("#sidebar-shortcuts").on("click",".btn",function(){var i=$(this).index(),s=$(this).data("tmenuids"),e=$("#sidebar .nav-list").eq(i);$("li",e).length||n.getMenus(i,s),e.removeClass("hide").siblings("ul").addClass("hide"),t($(this).attr("title"),null,$(this).children("i").attr("class"),0)}),$(".nav-list").on("click","a",function(){var n=$(this).children(".menu-text").text(),i=$(this).attr("href"),s=$(this).children("i").attr("class"),e=$(this).data("level");t(n,i,s,e)}),$("#breadcrumbs").on("click","li",function(t){return $(this).hasClass("active")?(t&&t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0,!1):($(this).addClass("active").nextAll("li").remove(),!0)})},getMenus:function(t,n){function i(t,n){return'<ul class="submenu">\r\n'+s(t,n)+"</ul>\r\n"}function s(t,n){var s,e,a,r="";return $.each(t,function(t,l){e=l.hasOwnProperty("sub_menus")&&l.sub_menus.length,a=n,s=l.hasOwnProperty("url")&&""!=l.url?l.url:"javascript:void(0);",r+="<li>\r\n",r+=' <a href="'+s+'" '+(e?'class="dropdown-toggle"':"")+' data-id="'+l.id+'" data-level="'+n+'" target="iframeStyle">\r\n<i class="'+l.icon+'"></i>\r\n<span class="menu-text"> '+l.name+" </span>\r\n"+(e?'<b class="arrow icon-angle-down"></b>\r\n':"")+"</a>\r\n",r+=e?i(l.sub_menus,a+1):"",r+="</li>\r\n"}),r}var e=this,a=$("#sidebar");e.myAjax({url:e.getUrl("menus"),type:e.getType("menus"),json:{userid:e.userid,tmenu_id:n}},function(n){var i=n.list,e=s(i,1);$("ul.nav-list",a).eq(t).html(e)})},getMsgList:function(t,n){function i(n,i){var s,e,r="todo"===t?"icon-envelope-alt":"icon-warning-sign";if(html=' <li class="nav-header">\r\n<i class="'+r+'"></i>您有 '+n+" 条消息\r\n</li>\r\n",n>0)for(s=0;n>s;s++)"todo"===t?html+='<li>\r\n<a href="#">\r\n<span class="msg-body">\r\n<span class="msg-title">\r\n<span class="blue">'+i[s].user+":</span> "+i[s].type+","+i[s].desc+' </span>\r\n<span class="msg-time"><i class="icon-time"></i><span> '+i[s].time+"</span></span>\r\n</span>\r\n</a>\r\n</li>\r\n":(e=i[s].num>0&&i[s].hasOwnProperty("num")?'<span class="pull-right badge badge-'+i[s].color+'">+'+i[s].num+"</span>\r\n":"",html+='<li>\r\n <a href="'+i[s].url+'">\r\n<div class="clearfix">\r\n<span class="pull-left"><i class="btn btn-mini no-hover btn-'+i[s].color+" "+i[s].icon+'"></i> '+i[s].desc+" </span>\r\n"+e+"</div>\r\n</a>\r\n</li>\r\n");return html+='<li><a href="'+a+'">查看所有消息<i class="icon-arrow-right"></i></a></li>'}n=n||30;var s=this,e=$("#"+t+"List"),a=$("."+t+"ListBox",e).children("li:last").children("a").attr("href");s.myAjax({url:s.getUrl(t+"List"),type:s.getType(t+"List"),json:{userid:s.userid}},function(a){var r=a.list,l=i(a.total,r);$("."+t+"Total",e).html(a.total),$("."+t+"ListBox",e).html(l),setTimeout(function(){s.getMsgList(t,n)},1e3*n)})}},$(document).ready(function(){new SmartHoneIndex});