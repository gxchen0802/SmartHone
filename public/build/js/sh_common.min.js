function Controller(){"use strict";this.tipsDialogId="smart-hong-tips",this.confirmDialogId="smart-hong-confirm",this.createModalDialog=function(t){var e=null===t||null===t.type||void 0===t.type?"dialog":t.type,a=t.id;"tips"===e?a=this.tipsDialogId:"confirm"===e&&(a=this.confirmDialogId);var n=null===t||null===t.tabindex||void 0===t.tabindex?null:t.tabindex,i=$(document.createElement("DIV")).attr("id",a).attr("role","dialog").attr("aria-labelledby","myModalLabel").addClass("modal fade");n&&$(i).attr("tabindex",n);var o=$(document.createElement("DIV")).attr("role","document").addClass("modal-dialog").append($(document.createElement("DIV")).addClass("modal-content"));$(i).append(o),$("body").prepend(i)},this.dialog=function(t){var e=null===t||null===t.tabindex||void 0===t.tabindex?null:t.tabindex;$("#"+t.id).size()>0&&$("#"+t.id).remove(),this.createModalDialog({type:"dialog",id:t.id,tabindex:e}),$("#"+t.id).modal({remote:t.url}),$.fn.modal.Constructor.prototype.enforceFocus=function(){}},this.tips=function(t,e,a,n){var i=this;$("#"+this.tipsDialogId).size()>0?($("#"+this.tipsDialogId+" .modal-tips").html(t),$("#"+this.tipsDialogId).modal("show")):(this.createModalDialog({type:"tips"}),$("#"+this.tipsDialogId).addClass("bs-example-modal-sm"),$("#"+this.tipsDialogId+" .modal-dialog").addClass("modal-sm"),$("#"+this.tipsDialogId+" .modal-content").append($(document.createElement("DIV")).addClass("modal-tips").html(t)),$("#"+this.tipsDialogId).modal({backdrop:n||!0,keyboard:!1})),e&&window.setTimeout(function(){$("#"+i.tipsDialogId).modal("hide"),a&&a()},1e3*e)},this.confirm=function(t){var e=this,a=null===t||null===t.title||void 0===t.title?"系统确认":t.title,n=null===t||null===t.content||void 0===t.content?"":t.content,i=null===t||null===t.confirmLabel||void 0===t.confirmLabel?"确认":t.confirmLabel,o=null===t||null===t.cancelLabel||void 0===t.cancelLabel?"取消":t.cancelLabel,s=null===t||null===t.confirmInterface||void 0===t.confirmInterface?null:t.confirmInterface,l=null===t||null===t.cancelInterface||void 0===t.cancelInterface?null:t.cancelInterface;$("#"+this.confirmDialogId).size()>0&&$("#"+this.confirmDialogId).remove(),this.createModalDialog({type:"confirm"}),$("#"+this.confirmDialogId+" .modal-content").append($(document.createElement("DIV")).addClass("modal-header").append('<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times; </span></button ><h4 class="modal-title">'+a+"</h4>")),$("#"+this.confirmDialogId+" .modal-content").append($(document.createElement("DIV")).addClass("modal-confirm").html(n));var r=$(document.createElement("DIV")).addClass("modal-footer"),d=$(document.createElement("BUTTON")).attr("type","button").addClass("btn btn-primary").text(i);$(d).click(function(){s&&s(),$("#"+e.confirmDialogId).modal("hide")}),$(r).append(d);var c=$(document.createElement("BUTTON")).attr("type","button").addClass("btn btn-default").attr("data-dismiss","modal").text(o);$(c).click(function(){l&&l()}),$(r).append(c),$("#"+this.confirmDialogId+" .modal-content").append(r),$("#"+this.confirmDialogId).modal({keyboard:!0})},this.throttle=function(t,e,a){var n,i=null;return function(){var o=this,s=arguments,l=+new Date;clearTimeout(i),n||(n=l),l-n>=a?(t.apply(o,s),n=l):i=setTimeout(function(){t.apply(o,s)},e)}},this.initSearchBar=function(t){function e(){a.height()>40?(a.css("height","40px"),o.css("visibility","visible ")):(a.css("height","auto"),o.css("visibility","hidden "))}var a=$(".search-bar"),n=($(".pull-left",a),$(".clear-conds",a)),i=$(".submit-btn",a),o=$(".search-icon",a);n.click(function(){a.find("input,select").val("")}),i.click(function(){t.autoTableList("refresh")}),a.on("click",".search-icon",function(){$(this).hasClass("icon-angle-down")?($(this).removeClass("icon-angle-down"),a.css("height","auto")):($(this).addClass("icon-angle-down"),a.css("height","40px")),t.autoTableList("setEditBg")}),e(),$(window).resize(function(){e()})},this.myAjax=function(t,e,a){if(!$.isFunction(e))return!1;var n=this,i=$.extend({url:"",type:"GET",json:"",dataType:"json",async:!0,cache:!1},t);try{$.ajax({url:i.url,type:i.type,data:i.json,dataType:i.dataType,async:i.async,timeout:3e4,cache:i.cache,headers:{Accept:"application/json; charset=utf-8","Content-Type":"application/json; charset=utf-8"},success:function(t){"success"===t.result?e(t):n.tips('<p class="text-error"><i class="icon-remove"></i> '+t.message+"</p>",3)},error:function(t,e){return $.isFunction(a)&&a?void a():"timeout"==e?(n.tips('<p class="text-error"><i class="icon-remove"></i> ajax Error: 请求超时！</p>',3),!1):(n.tips('<p class="text-error"><i class="icon-remove"></i> ajax Error : 其他错误,'+e+"</p>",3),!1)}})}catch(o){console.log("错误名称："+o.name+"\n错误描述："+o.message)}},this.getFormJson=function(t){var e={},a="";return $.each(t.serializeArray(),function(t,n){a=n.name,e[a]=n.value}),e}}function Port(){"use strict";var t={menus:{url:"/json/menus.json",type:"get"},todoList:{url:"/json/todo_list.json",type:"get"},noticeList:{url:"/json/notice_list.json",type:"get"},ping:{url:"/json/ping.json",type:"get"},searchUser:{url:"/{$app}/searchUser",type:"post"},dynTable:{url:"/json/dynTable.json",type:"get"},editTable:{url:"/json/ping.json",type:"post"},quickDele:{url:"/json/ping.json",type:"get"}};this.getUrl=function(e){return t.hasOwnProperty(e)?t[e].url:null},this.getType=function(e){return t.hasOwnProperty(e)?t[e].type:null}}function getUserId(){return 1111}$.fn.autoTableList=function(t){"use strict";function e(t,e){Controller.call(this),this.opts=e,this._this=$(t),this.editTr=null,this.init()}var a={dataModel:null,checkBox:1,container:null,form:null,port:null,hasPagination:1,pageSize:10,quickEdit:1,quickEditSaveFun:null,order:1};if("object"==typeof t){if(a=$.extend(!0,{},a,t),"object"!=typeof a.dataModel)throw new Error("autoTableList dataModel error : 不是一个对象 !");if(null===a.container||"string"!=typeof a.container)throw new Error("autoTableList container error : 请使用table的ID绑定");if(null===a.form||"string"!=typeof a.form)throw new Error("autoTableList form error : 请使用form的ID绑定");if(null===a.port||"string"!=typeof a.port)throw new Error("autoTableList port error : ajax port 不正确");if(a.pageSize<=0||"number"!=typeof a.pageSize)throw new Error("autoTableList port error : 分页不正确")}else if("string"!=typeof t||"undefined"===t)throw new Error("autoModel Parameter error : options error !");e.prototype={init:function(){this.insertHtmlFun(),this.insertListFun(1),this.attachEventFun()},insertHtmlFun:function(){var t=this;t._this.addClass("table-con"),t.table=$("#"+t.opts.container),t.table.length||(t.table=$('<table id="'+t.opts.container+'" class="table table-striped table-bordered table-hover"></table>').appendTo(t._this)),t.pagination=$("#pagination"),t.opts.hasPagination&&!t.pagination.length&&(t.pagination=$('<div id="pagination" class="pagination clearfix"></div>').appendTo(t._this)),t.opts.quickEdit&&(t._this.append('<form id="editForm"></form>\n\r<div class="table-bg"></div>'),t.editTable=$('<table class="table table-striped table-bordered  inside-edit"><tbody><tr></tr></tbody></table>').appendTo("#editForm"));var e=t.opts.dataModel;if(e.hasOwnProperty("columnDef")&&e.columnDef.length&&(t.theadData=t.setTheadData(e.columnDef)),e.hasOwnProperty("tableColumn")&&e.tableColumn.length&&(t.theadData=t.setTheadData(e.tableColumn)),t.opts.order){var a=$("#"+t.opts.form);$.each(e.tbody,function(e,n){a.append('<input type="hidden" name="'+n+'" value="'+(t.theadData[e].order||"disabled")+'" id="order-'+n+'">')})}},attachEventFun:function(){var t=this;if(t.opts.hasPagination&&t._this.on("click","#pagination li",function(e){var a=$(this).data("page");$("#page").val(a),t.insertListFun(),t.stopBubble(e)}),t.opts.dataModel.hasOwnProperty("btns")&&t.opts.dataModel.btns.length){var e=t.opts.dataModel.btns;$.each(e,function(e,a){a.hasOwnProperty("fun")&&$.isFunction(a.fun)&&t.table.on("click","#"+a.id,function(e){return a.fun($(this),t._this,t.table),t.stopBubble(e),!1})})}t.checkboxFun(),t.opts.quickEdit&&(t.table.on("click","tbody>tr",function(e){t.editTr=$(this),t.insertEditTable(),t.autoEditTable(),t._this.addClass("onEdit"),t.stopBubble(e)}),$(window).resize(t.throttle(function(){t.setEditTableWidth(),t.autoEditTable()},70,150)),t.editTable.on("click",".et-close",function(e){t.closeEditTable(),t.stopBubble(e)}).on("click",".et-save",function(e){if(t.opts.hasOwnProperty("quickEditSaveFun")&&$.isFunction(t.opts.quickEditSaveFun)){var a={_this:$(this),element:t._this,editTable:t.editTable,editForm:t._this.find("#editForm"),closeEditTable:function(e){t.closeEditTable(e)}};t.opts.quickEditSaveFun(a),t.stopBubble(e)}})),t.opts.order&&t.table.on("click","thead>tr>th",function(){var e=$(this).attr("data-order").split("|"),a="";switch($(this).removeClass("sort-none sort-asc sort-desc"),e[1]){case"none":$(this).attr("data-order",e[0]+"|asc").addClass("sort-asc"),a="asc";break;case"asc":$(this).attr("data-order",e[0]+"|desc").addClass("sort-desc"),a="desc";break;case"desc":$(this).attr("data-order",e[0]+"|none").addClass("sort-none"),a="none"}$("#order-"+e[0]).val(a),t.insertListFun()})},checkboxFun:function(){var t=this;t.table.on("click",".checkAll",function(e){$(this).prop("checked")?t.table.find(".ch").prop("checked",!0):t.table.find(".ch").prop("checked",!1),t.stopBubble(e)}).on("click",".ch",function(e){var a=t.table.find(".ch").length,n=t.table.find(".ch:checked").length;a===n?t.table.find(".checkAll").prop("checked",!0):t.table.find(".checkAll").prop("checked",!1),t.stopBubble(e)}).on("click",".no-edit",function(e){return t.stopBubble(e),!1})},setTbodyData:function(t){var e={},a="";return $.each(t,function(t,n){a=n.id,e[a]=null==n?"":n}),e},setTheadData:function(t){var e,a,n,i=t.length;for(e=0;i>e;e++)if(t[e].hasOwnProperty.index)for(a=e+1;i>a;a++)t[a].hasOwnProperty.index&&t[e].index>t[a].index&&(n=t[a],t[a]=t[e],t[e]=n);return console.log(JSON.stringify(t)),t},insertEditTable:function(){var t,e=this,a="",n=e.editTr.data("id"),i=e.tbodyData[n],o=e.opts.dataModel;e.opts.checkBox&&(a+='<td class="center"><span class="no-ch"></span></td>\n'),$.each(o.tbody,function(n,o){t=e.theadData[n],t.hasOwnProperty("renderFunction")&&$.isFunction(t.renderFunction)?a+="<td>"+t.renderFunction(t,i,o)+"</td>":(t.hasOwnProperty("optionData")&&e.selList.hasOwnProperty(t.optionData)&&e.selList[t.optionData].length&&(t.option=e.selList[t.optionData]),a+="<td>"+e["set"+t.type.toLowerCase()+"Fun"](t,i,o)+"</td>\n")}),a+='<td><a href="javascript:void(0);" class="btn btn-mini btn-success et-save"><i class="icon-ok"></i></a><a href="javascript:void(0);" class="btn btn-mini btn-danger et-close"><i class="icon-remove"></i></a></td>\n',e.editTable.find("tr").html(a),e.editTable.find(".date-picker").datepicker().next().on(ace.click_event,function(){$(this).prev().focus()}),e.setEditTableWidth()},setstringFun:function(t,e,a){return'<input type="text" name="'+a+'" value="'+e[a]+'" class="edit-box">'},setintFun:function(t,e,a){return'<input type="text" name="'+a+'" value="'+e[a]+'" class="edit-box">'},setdateFun:function(t,e,a){return'<div class="row-fluid input-append edit-box"><input type="text" name="'+a+'" value="'+e[a]+'" class="date-picker" readonly="readonly" data-date-format="yyyy-dd-mm"><span class="add-on"><i class="icon-calendar"></i></span></div>'},setselectFun:function(t,e,a){var n="",i="";return $.each(t.option,function(t,o){i=o.name===e[a]?' selected="selected" ':"",n+="<option "+i+' value="'+o.value+'">'+o.name+"</option>"}),'<select class="input-small" id="'+a+'" name="'+a+'">'+n+"</select>\n"},setEditTableWidth:function(){{var t,e=this,a=e.table.find("th"),n=e.editTable.find("td");e.opts.dataModel}a.each(function(e){t=$(this).width(),n.eq(e).css("width",t).children(".edit-box").css("width",t-30)})},autoEditTable:function(){var t=this;null!==t.editTr&&(t._this.find(".table-bg").css({top:t.table.offset().top,left:t.table.offset().left,width:t.table.outerWidth(),height:t.table.outerHeight()}),t.editTable.css({top:t.editTr.offset().top,left:t.editTr.offset().left,width:t.table.outerWidth()}))},closeEditTable:function(t){this.editTr=null,this._this.removeClass("onEdit"),t&&this.insertListFun()},insertListFun:function(t){var e=this,a=$("#"+e.opts.form),n={url:e.opts.port,json:e.getFormJson(a),type:"get",cache:!0};e.tips('<p class="text-info"> 数据载入中，请稍候……</p>',null,null,"static"),e.opts.quickEdit&&null!==e.editTr&&e.closeEditTable(),e.myAjax(n,function(a){e.saveData(a),e.showTableList(a,t||0),e.shwoPagination(a),$("#"+e.tipsDialogId).modal("hide")})},stopBubble:function(t){t&&t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0},saveData:function(t){var e=this;t.hasOwnProperty("valueList")&&t.valueList.length&&(e.tbodyData=e.setTbodyData(t.valueList)),e.selList=t.columnOption},showTableList:function(t,e){var a=this,n=a.opts.dataModel;e&&(n.hasOwnProperty("tableColumn")&&n.tableColumn.length&&a.theadData.length&&a.returnThead(n,a.theadData),n.hasOwnProperty("columnDef")&&n.columnDef.length&&a.theadData.length&&a.returnDiyThead(n,a.theadData)),n.hasOwnProperty("tbody")&&n.tbody.length&&t.hasOwnProperty("valueList")&&t.valueList.length&&a.returnTbody(n,t.valueList)},returnThead:function(t,e){var a,n,i=this,o=$("thead",i.table),s=0;if(!o.length)throw new Error("autoTableList thead error : 没有找到<thead>标签 !");i.opts.checkBox&&($("tr>th:first",o).addClass("center no-edit").attr("width","1").html('<label><input type="checkbox" class="checkAll" value=""><span class="lbl"></span></label>'),s=1),$.each(e,function(e,l){a=(t.hasOwnProperty("classname")&&t.classname.length?t.classname[e]:"")+(i.opts.order&&"undefined"!=t.tbody[e]?" sort-"+(l.order||"none"):" sort-disabled"),n=i.opts.order?l.order||"none":"disabled",console.log(e,s+e,i.opts.order&&"undefined"!=t.tbody[e]),$("tr>th",o).eq(s+e).addClass(a).attr({width:l.width,"data-order":t.tbody[e]+"|"+n})})},returnDiyThead:function(t,e){var a,n,i=this,o="",s=i.table.children("thead");s.length||(s=$("<thead></thead>").appendTo(i.table)),i.opts.checkBox&&(o+='<th class="center no-edit" width="1"><label><input type="checkbox" class="checkAll" value=""><span class="lbl"></span></label></th>\n'),$.each(e,function(e,s){a=(t.hasOwnProperty("classname")&&t.classname.length?t.classname[e]:"")+(i.opts.order?" sort-"+(s.order||"none"):" sort-disabled"),n=i.opts.order?s.order:"disabled",o+='<th width="'+s.width+'" class="'+a+'" data-order="'+t.tbody[e]+"|"+(s.order||"none")+'">'+s.name+"</th>\n"}),s.html("<tr>\n"+o+"</tr>\n")},returnTbody:function(t,e){var a,n=this,i="",o=n.table.children("tbody");o.length||(o=$("<tbody></tbody>").appendTo(n.table)),$.each(e,function(e,o){i+='<tr data-id="'+o.id+'">\n',n.opts.checkBox&&(i+='<td class="center no-edit" width="1"><label><input type="checkbox" class="ch" value="'+o.id+'"><span class="lbl"></span></label></td>\n'),$.each(t.tbody,function(e,n){a=t.hasOwnProperty("className")&&t.className.length?t.className[n]:"",i+='<td class="'+a+'">'+o[n]+"</td>\n"}),t.hasOwnProperty("btns")&&t.btns.length&&(a=t.hasOwnProperty("className")&&t.className.length?t.className[t.className.length-1]:"",i+='<td class="'+a+' no-edit">'+n.getBtnsFun(t,o)+"</td>\n"),i+="</tr>\n"}),o.html(i)},getBtnsFun:function(t,e){var a="",n="",i="";return $.each(t.btns,function(t,o){if(o.hasOwnProperty("attr")&&"object"==typeof o.attr){var s="",l=o.attr;for(var r in l)s+=r+'="'+e[l[r]]+'" '}i=o.hasOwnProperty("id")&&""!=o.id?'id="'+o.id+'" ':"",n=o.hasOwnProperty("icon")&&""!=o.icon?'<i class="'+o.icon+'"></i>':"",a+="<button "+i+s+' class="'+o.className+'" type="button">'+n+(o.text||"")+"</button>\n"}),a},shwoPagination:function(t){var e=this;if(e.opts.hasPagination){var a=t.total,n=e.opts.pageSize,i=t.page+1,o=Math.ceil(a/n),s=o>5?5:o,l=0>=i-3?1:i+2>=o?o+1-s:i-2,r=i+2>=o?o:s>i+2?s:i+2,d="";if(d='<div class="total pull-left">\n<span class="text-primary arial">1-'+o+'页</span>\n<span> / 共</span>\n<span class="text-primary arial">'+a+'</span>\n<span>条</span>\n</div>\n<ul class="pull-right">\n',0!=a){d+=1==i?"":'<li data-page="1"><a href="javascript:void(0);"><i class="icon-double-angle-left"></i></a></li>\n<li data-page="'+(i-1)+'"><a href="javascript:void(0);"><i class="icon-angle-left"></i></a></li>\n';for(var c=l;r+1>c;c++)d+=c==i?'<li class="active"><a href="javascript:void(0);">'+c+"</a></li>\n":'<li data-page="'+c+'"><a href="javascript:void(0);">'+c+"</a></li>\n";d+=i==o?"":'<li data-page="'+(i+1)+'"><a href="javascript:void(0);"><i class="icon-angle-right"></i></a></li>\n<li data-page="'+o+'"><a href="javascript:void(0);"><i class="icon-double-angle-right"></i></a></li>\n'}d+="</div>\n",e.pagination.html(d)}},refresh:function(){this.insertListFun()},setEditBg:function(){this.opts.quickEdit&&null!==this.editTr&&this.autoEditTable()}};try{var n=$(this),i=n.data("tablelist");i||n.data("tablelist",i=new e(this,a)),"string"==typeof t&&/^(refresh|setEditBg)$/.test(t)&&i[t]()}catch(o){throw new Error("tablelist error:"+o.message)}};